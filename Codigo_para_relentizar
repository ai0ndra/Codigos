#include <ServoEasing.hpp>

ServoEasing SERVO1;
ServoEasing SERVO2;
ServoEasing SERVO3;
ServoEasing SERVO4;
ServoEasing SERVO5;

// VELOCIDAD para el movimiento normal (Grados por segundo)
int velocidad = 30;
int espera    = 1000;

// Función para alcanzar la posición inicial usando "pasos" manuales
// Movemos de 80 a 90 para asegurar que veas movimiento físico.
void alcanzarHomeConPasos(ServoEasing &servo, int pin, int destino) {
  servo.attach(pin);

  // Forzamos un inicio desde 80 para garantizar que el servo se mueva lentamente hasta 90.
  // Esto ayuda a confirmar que el código está funcionando y "suaviza" el tramo final.
  for (int p = 80; p <= destino; p++) {
    servo.write(p);
    delay(100); // 100ms por grado = movimiento muy visible y pausado
  }
}

void setup() {
  // ----- PASO 1: ALCANZAR POSICIÓN INICIAL (90) CON PASOS MANUALES -----
  // Se hace uno por uno de forma secuencial para evitar picos de corriente (600mA)
  alcanzarHomeConPasos(SERVO1, 23, 90);
  delay(espera);
  alcanzarHomeConPasos(SERVO2, 33, 90);
  delay(espera);
  alcanzarHomeConPasos(SERVO3, 32, 90);
  delay(espera);
  alcanzarHomeConPasos(SERVO4, 25, 90);
  delay(espera);
  alcanzarHomeConPasos(SERVO5, 22, 90);
  delay(espera);

  // ----- PASO 2: CONFIGURAR LIBRERÍA PARA EL RESTO DEL CÓDIGO -----
  SERVO1.setEasingType(EASE_CUBIC_IN_OUT);
  SERVO2.setEasingType(EASE_CUBIC_IN_OUT);
  SERVO3.setEasingType(EASE_CUBIC_IN_OUT);
  SERVO4.setEasingType(EASE_CUBIC_IN_OUT);
  SERVO5.setEasingType(EASE_CUBIC_IN_OUT);

  delay(espera);
}

void loop() {
  // -------- SECUENCIA 1: IR A HOME (90) - MOVIMIENTO PARALELO --------
  SERVO1.startEaseTo(90, velocidad);
  SERVO2.startEaseTo(90, velocidad);
  SERVO3.startEaseTo(90, velocidad);
  SERVO4.startEaseTo(90, velocidad);
  SERVO5.startEaseTo(90, velocidad);
  ServoEasing::synchronizeAllServosStartAndWaitForAllServosToStop();
  delay(espera);

  // -------- SECUENCIA 2: IR A TRABAJO - MOVIMIENTO PARALELO --------
  SERVO1.startEaseTo(60, velocidad);
  SERVO4.startEaseTo(125, velocidad);
  SERVO3.startEaseTo(65, velocidad);
  SERVO2.startEaseTo(120, velocidad);
  SERVO5.startEaseTo(35, velocidad);
  ServoEasing::synchronizeAllServosStartAndWaitForAllServosToStop();
  delay(espera);

  SERVO2.startEaseTo(80, velocidad);
  SERVO4.startEaseTo(90, velocidad);
  ServoEasing::synchronizeAllServosStartAndWaitForAllServosToStop();
  delay(espera);

  SERVO1.startEaseTo(90, velocidad);
  SERVO2.startEaseTo(95, velocidad);
  SERVO3.startEaseTo(90, velocidad);
  SERVO4.startEaseTo(60, velocidad);
  SERVO5.startEaseTo(90, velocidad);
  ServoEasing::synchronizeAllServosStartAndWaitForAllServosToStop();
  delay(espera);
}
